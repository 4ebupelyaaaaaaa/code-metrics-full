# Code Metrics Backend

**Code Metrics Backend** — это серверная часть системы анализа кода, предоставляющая API для загрузки архивов, вычисления метрик (цикломатическая сложность, дублирование, глубина вложенности и др.), формирования отчётов и генерации PDF-документов.

---

# Технологии, используемые для реализации проекта:

- NodeJS
- Express
- Sequelize (ORM)
- PostgreSQL
- @babel/parser & @babel/traverse
- Multer (загрузка файлов)
- PDFKit (генерация PDF)
- adm-zip & unzipper (работа с архивами)
- bcrypt (хеширование паролей)
- JSON Web Token (авторизация)
- dotenv (управление переменными окружения)

# Настройка проекта

### Для корректной работы необходима версия NodeJS >= 18.12.1

Как запустить проект:

```shell
# Клонировать репозиторий:
git clone https://github.com/4ebupelyaaaaaaa/code-metrics-full

# Перейти в директорию бэкенда:
cd code-metrics-full/cyclomatic-server

# Установить зависимости
npm install

# Для запуска проекта выполнить команду:
npm start

# Перейти к запуску фронтенда:
cd code-metrics-full/cyclomatic-scope-helper-main/readme.md
```

---

# Основные возможности

- Приём zip-архивов с исходным кодом

- Анализ по множеству метрик:

1. Цикломатическая сложность

2. Глубина вложенности

3. Когнитивная сложность

4. Читабельность

5. Комментарии

6. Повторяющийся код (дубликаты)

- Генерация отчёта в формате PDF

- Отправка данных в формате json на фронт

# Основные API-эндпоинты

| Метод | URL                  | Описание                                   |
| ----- | -------------------- | ------------------------------------------ |
| POST  | `/api/report/report` | Загрузка архива и анализ кода              |
| GET   | `/api/history/:id`   | Получение истории по ID пользователя       |
| POST  | `/api/history/:id`   | Запись отчета в историю по ID пользователя |
| POST  | `/api/login`         | Авторизация пользователя                   |
| POST  | `/api/register`      | Регистрация пользователя                   |

---

# Подключение к базе данных

В проекте используется PostgreSQL. Ниже описано, как настроить и подключиться к БД.

## Переменные окружения

При необходимости создайте файл `.env` в корне папки `cyclomatic-server` и заполните его (в репозитории он уже есть):

```env
# Настройки сервера
PORT=5000
JWT_SECRET=<ваш_JWT>

# Параметры подключения к PostgreSQL
DB_HOST=localhost
DB_PORT=5432
DB_NAME=cyclomatic
DB_USER=<ваш_пользователь>
DB_PASSWORD=<ваш_пароль>

```

## Запуск сервера с подключённой БД

```shell
# Установите зависимости и переменные окружения

# Запустите сервер:
npm install
npm start

# В логах вы увидите:
DB connected and synced
Server started on port 5000

```

---
